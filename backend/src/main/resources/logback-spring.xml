<configuration>
    <!-- ========================================
         ðŸ“Œ ê°œì„ ì‚¬í•­ 1: ì¼ë°˜ ë¡œê·¸ (INFO ì´ìƒ)
         - ìµœëŒ€ 30ì¼ ë³´ê´€ (30ì¼)
         - íŒŒì¼ë‹¹ 100MB ì œí•œ
         - ì „ì²´ 5GB ì œí•œ
         - .gz ì••ì¶• ì ìš©
    ========================================= -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/app.log</file>
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/app-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>
            <maxFileSize>100MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>5GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- ========================================
         ðŸ“Œ ê°œì„ ì‚¬í•­ 2: ERROR ì „ìš© ë¡œê·¸ ë¶„ë¦¬
         - ì—ëŸ¬ ë¡œê·¸ë§Œ ë³„ë„ íŒŒì¼ë¡œ ì €ìž¥
         - ìµœëŒ€ 90ì¼ ë³´ê´€ (ì¤‘ìš” ì—ëŸ¬ëŠ” ì˜¤ëž˜ ë³´ê´€)
         - íŒŒì¼ë‹¹ 50MB ì œí•œ
         - ì „ì²´ 2GB ì œí•œ
    ========================================= -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/error.log</file>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/error-%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>90</maxHistory>
            <totalSizeCap>2GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n%ex{full}</pattern>
        </encoder>
    </appender>

    <!-- ========================================
         ðŸ“Œ ê°œì„ ì‚¬í•­ 5: ë¹„ë™ê¸° ë¡œê¹… (ì„±ëŠ¥ í–¥ìƒ)
    ========================================= -->
    <appender name="ASYNC_FILE" class="ch.qos.logback.classic.AsyncAppender">
        <queueSize>512</queueSize>
        <discardingThreshold>0</discardingThreshold>
        <appender-ref ref="FILE"/>
    </appender>

    <appender name="ASYNC_ERROR_FILE" class="ch.qos.logback.classic.AsyncAppender">
        <queueSize>256</queueSize>
        <discardingThreshold>0</discardingThreshold>
        <appender-ref ref="ERROR_FILE"/>
    </appender>

    <!-- ========================================
         ì½˜ì†” ì¶œë ¥ (ê°œë°œ í™˜ê²½ìš©)
    ========================================= -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} %highlight(%-5level) %cyan(%logger{36}) - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- ========================================
         Hibernate ì¿¼ë¦¬ ë¡œê·¸
    ========================================= -->
    <logger name="org.hibernate.SQL" level="DEBUG" additivity="false">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="ASYNC_FILE"/>
    </logger>

    <logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="TRACE" additivity="false">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="ASYNC_FILE"/>
    </logger>

    <!-- ========================================
         ðŸ“Œ ê°œì„ ì‚¬í•­ 4: í™˜ê²½ë³„ ë¡œê·¸ ë ˆë²¨ ë¶„ë¦¬
    ========================================= -->

    <!-- ë¡œì»¬ í™˜ê²½: DEBUG ë ˆë²¨, ì½˜ì†” + íŒŒì¼ -->
    <springProfile name="local">
        <root level="DEBUG">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="ASYNC_FILE"/>
            <appender-ref ref="ASYNC_ERROR_FILE"/>
        </root>
    </springProfile>

    <!-- ìš´ì˜ í™˜ê²½: INFO ë ˆë²¨, íŒŒì¼ë§Œ (ì½˜ì†” ì œê±°ë¡œ ì„±ëŠ¥ í–¥ìƒ) -->
    <springProfile name="prod">
        <root level="INFO">
            <appender-ref ref="ASYNC_FILE"/>
            <appender-ref ref="ASYNC_ERROR_FILE"/>
        </root>
    </springProfile>

    <!-- ê¸°ë³¸ í™˜ê²½ (í”„ë¡œí•„ ë¯¸ì§€ì • ì‹œ) -->
    <springProfile name="!local &amp; !prod">
        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="ASYNC_FILE"/>
            <appender-ref ref="ASYNC_ERROR_FILE"/>
        </root>
    </springProfile>
</configuration>

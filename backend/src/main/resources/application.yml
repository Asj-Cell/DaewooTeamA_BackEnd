# main/resources/application.yml

spring:
  config:
    import: "optional:classpath:application-${spring.profiles.active}.yml"
  application:
    name: booking-backend
  sql:
    init:
      mode: always  # 로컬에서는 매번 실행
      schema-locations: classpath:schema.sql
      data-locations: classpath:data.sql
  # --- JPA 공통 설정 ---
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:

        format_sql: true
        show_sql: false
        jdbc:
          lob:
            non_contextual_creation: true
    open-in-view: false
    database-platform: org.hibernate.dialect.MariaDBDialect # 최신 Dialect

  # --- 이메일 공통 설정 ---
  mail:
    host: smtp.naver.com
    port: 587
    username: ${SPRING_MAIL_USERNAME}
    password: ${SPRING_MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
        ssl: # mail.smtp 아래가 아닌 mail.properties 아래로 이동 (구조 수정)
          trust: smtp.naver.com
          protocols: TLSv1.2

  # --- 파일 업로드 공통 설정 ---
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
      enabled: true
      file-size-threshold: 0

  # --- OAuth2 클라이언트 설정 ---
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope:
              - email
              - profile
          naver:
            client-id: ${NAVER_CLIENT_ID}
            client-secret: ${NAVER_CLIENT_SECRET}
            client-name: Naver
          kakao:
            client-id: ${KAKAO_CLIENT_ID}
            client-secret: ${KAKAO_CLIENT_SECRET}
            client-name: Kakao
            provider: kakao # 필수 설정

server:
  port: 8888
# --- JWT 설정 ---
jwt:
  secret:
    key: ${JWT_SECRET_KEY}
  token:
    expiration-time: 3600000 # 1시간 (밀리초)
    refresh-expiration-time: 2592000000 # 30일 (리프레시 토큰)

# --- 로깅 설정 ---
# ⚠️ 상세 로그 설정은 logback-spring.xml에서 관리
# 여기서는 로그 레벨만 설정
logging:
  level:
    root: INFO
    com.example.backend: INFO
    org.hibernate.SQL: WARN
    org.springframework.security: WARN

# --- Toss Payments 설정 ---
toss:
  payments:
    secret-key: "test_gsk_docs_OaPz8L5KdmQXkzRz3y47BMw6"
    confirm-url: "${app.url}/api/v1/payments/confirm"
    fail-url: "${app.url}/payment/fail"
    success-url: "${app.url}/payment/success"


# --- Actuator 설정 ---
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when_authorized
      roles: ADMIN

# --- Swagger (Springdoc) 설정 ---
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    doc-expansion: none
  default-produces-media-type: application/json
  show-actuator: true